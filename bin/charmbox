#!/bin/sh
#
# Starts up the charmbox like I prefer
#
# https://hub.docker.com/r/jujusolutions/charmbox/
# https://github.com/juju-solutions/charmbox
#
# Docker allows bind mounting, LXD allows local juju. For these reasons I use the charmbox for
# development and the LXD mojo image for testing.

if [ $# -ne 1 ]; then
  container_name='charmbox'
  extra_args='--rm' # Make it emphermal if unnamed
else
  container_name=$1
  extra_args=''
fi

exited_containers=$(docker ps -a --filter "status=exited" --format "{{.Names}}")

found='false'
for name in $exited_containers; do
  if [ $name = $container_name ]; then
    found='true'
  fi
done

if [ $found = 'true' ]; then
  exec docker start -i $container_name
else
  exec docker run \
    --name $container_name -h $container_name \
    -v /home/tim/src:/home/ubuntu/src \
    -v /home/tim/.go-cookies:/home/ubuntu/.go-cookies \
    -v /home/tim/.local/share/juju:/home/ubuntu/.local/share/juju \
    -v $JUJU_REPOSITORY/layers:/home/ubuntu/layers \
    -v $JUJU_REPOSITORY/trusty:/home/ubuntu/trusty \
    -v $JUJU_REPOSITORY/xenial:/home/ubuntu/xenial \
    -t -i $extra_args \
    jujusolutions/charmbox
fi
